<h1 id="pixi-live2d-display">pixi-live2d-display</h1>
<p><img
src="https://img.shields.io/github/package-json/v/guansss/pixi-live2d-display?style=flat-square"
alt="GitHub package.json version" /> <img
src="https://img.shields.io/badge/Cubism-2/3/4-ff69b4?style=flat-square"
alt="Cubism version" /> <img
src="https://img.shields.io/github/workflow/status/guansss/pixi-live2d-display/Test%20CI?style=flat-square"
alt="GitHub Workflow Status" /></p>
<blockquote>
<p>:warning: 该 readme 版本为 v0.4.0，如果要找 v0.3.1 版本的话, 请查看<a
href="https://github.com/guansss/pixi-live2d-display/blob/dfa7f764f241c1c802e92a7ab490206369746efd/README.md">这里</a>.</p>
</blockquote>
<p>为 <a href="https://github.com/pixijs/pixi.js">PixiJS</a> v6 提供的
Live2D 插件</p>
<p>此项目旨在成为 web 平台上的通用 Live2D 框架。由于 Live2D
的官方框架非常复杂且不可靠，这个项目已将其重写以提供统一且简单的
API，使你可以从较高的层次来控制 Live2D
模型而无需了解其内部的工作原理</p>
<h4 id="特性">特性</h4>
<ul>
<li>支持所有版本的 Live2D 模型</li>
<li>支持 PIXI.RenderTexture 和 PIXI.Filter</li>
<li>Pixi 风格的变换 API：position, scale, rotation, skew, anchor</li>
<li>自动交互：鼠标跟踪, 点击命中检测</li>
<li>比官方框架更好的动作预约逻辑</li>
<li>从上传的文件或 zip 文件中加载 (实验性功能)</li>
<li>完善的类型定义 - 我们都喜欢类型！</li>
</ul>
<h4 id="要求">要求</h4>
<ul>
<li>PixiJS：&gt;6</li>
<li>浏览器：WebGL， ES6</li>
</ul>
<h4 id="示例">示例</h4>
<ul>
<li><a
href="https://codepen.io/guansss/pen/oNzoNoz/left?editors=1010">基础示例</a></li>
<li><a
href="https://codepen.io/guansss/pen/KKgXBOP/left?editors=0010">交互示例</a></li>
<li><a
href="https://codepen.io/guansss/pen/qBaMNQV/left?editors=1010">渲染纹理与滤镜示例</a></li>
<li><a href="https://guansss.github.io/live2d-viewer-web/">Live2D Viewer
Online</a></li>
</ul>
<h4 id="文档">文档</h4>
<ul>
<li><a
href="https://guansss.github.io/pixi-live2d-display">文档</a>（暂无中文翻译）</li>
<li><a
href="https://guansss.github.io/pixi-live2d-display/api/index.html">API
文档</a></li>
</ul>
<h2 id="cubism">Cubism</h2>
<p>Cubism 是 Live2D SDK 的名称，目前有 3 个版本：Cubism 2.1、Cubism
3、Cubism 4，其中 Cubism 4 可以与 Cubism 3 的模型兼容</p>
<p>该插件使用 Cubism 2.1 和 Cubism 4，从而支持所有版本的 Live2D 模型</p>
<h4 id="cubism-core">Cubism Core</h4>
<p>在使用该插件之前，你需要加载 Cubism 运行时，也就是 Cubism Core</p>
<p>Cubism 4 需要加载 <code>live2dcubismcore.min.js</code>，可以从 <a
href="https://www.live2d.com/download/cubism-sdk/download-web/">Cubism 4
SDK</a> 里解压出来，或者直接引用<a
href="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js">这个链接</a>
（<em>链接偶尔会挂掉，不要在生产版本中使用！</em>）</p>
<p>Cubism 2.1 需要加载 <code>live2d.min.js</code>，<a
href="https://help.live2d.com/en/other/other_20/">从 2019/9/4 起</a>
，官方已经不再提供该版本 SDK 的下载，但是可以从 <a
href="https://github.com/dylanNew/live2d/tree/master/webgl/Live2D/lib">这里</a>
找到，以及你大概想要的 <a
href="https://cdn.jsdelivr.net/gh/dylanNew/live2d/webgl/Live2D/lib/live2d.min.js">CDN
链接</a></p>
<h4 id="单独的打包文件">单独的打包文件</h4>
<p>该插件为每个 Cubism
版本提供了单独的打包文件，从而在你只想使用其中一个版本的时候减少需要加载文件的大小。</p>
<p>具体来说，为两种版本分别提供了 <code>cubism2.js</code> 和
<code>cubism4.js</code>，以及一个同时包含了两种版本的
<code>index.js</code></p>
<p>注意，如果你想同时支持 Cubism 2.1 和 Cubism 4 的话，请使用
<code>index.js</code>，<em>而不要同时使用</em> <code>cubism2.js</code>
和 <code>cubism4.js</code></p>
<p>为了更明确一点，这里列出使用这些文件的方法：</p>
<ul>
<li>使用 <code>cubism2.js</code>+<code>live2d.min.js</code> 以支持
Cubism 2.1 模型</li>
<li>使用 <code>cubism4.js</code>+<code>live2dcubismcore.min.js</code>
以支持 Cubism 3 和 Cubism 4 模型</li>
<li>使用
<code>index.js</code>+<code>live2d.min.js</code>+<code>live2dcubismcore.min.js</code>
以支持所有版本的模型</li>
</ul>
<h2 id="安装">安装</h2>
<h4 id="通过-npm">通过 npm</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install pixi-live2d-display</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Live2DModel } <span class="im">from</span> <span class="st">&#39;pixi-live2d-display&#39;</span><span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 如果只需要 Cubism 2.1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Live2DModel } <span class="im">from</span> <span class="st">&#39;pixi-live2d-display/cubism2&#39;</span><span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">// 如果只需要 Cubism 4</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Live2DModel } <span class="im">from</span> <span class="st">&#39;pixi-live2d-display/cubism4&#39;</span><span class="op">;</span></span></code></pre></div>
<h4 id="通过-cdn">通过 CDN</h4>
<div class="sourceCode" id="cb3"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;https://cdn.jsdelivr.net/npm/pixi-live2d-display/dist/index.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 如果只需要 Cubism 2.1 --&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;https://cdn.jsdelivr.net/npm/pixi-live2d-display/dist/cubism2.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 如果只需要 Cubism 4 --&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;https://cdn.jsdelivr.net/npm/pixi-live2d-display/dist/cubism4.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>通过这种方式加载的话，所有成员都会被导出到 <code>PIXI.live2d</code>
命名空间下，比如 <code>PIXI.live2d.Live2DModel</code></p>
<h2 id="基础使用">基础使用</h2>
<div class="sourceCode" id="cb4"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> PIXI <span class="im">from</span> <span class="st">&#39;pixi.js&#39;</span><span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Live2DModel } <span class="im">from</span> <span class="st">&#39;pixi-live2d-display&#39;</span><span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 将 PIXI 暴露到 window 上，这样插件就可以通过 window.PIXI.Ticker 来自动更新模型</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">PIXI</span> <span class="op">=</span> PIXI<span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>(<span class="kw">async</span> <span class="kw">function</span> () {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> app <span class="op">=</span> <span class="kw">new</span> PIXI<span class="op">.</span><span class="fu">Application</span>({</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">view</span><span class="op">:</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;canvas&#39;</span>)<span class="op">,</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> model <span class="op">=</span> <span class="cf">await</span> Live2DModel<span class="op">.</span><span class="fu">from</span>(<span class="st">&#39;shizuku.model.json&#39;</span>)<span class="op">;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    app<span class="op">.</span><span class="at">stage</span><span class="op">.</span><span class="fu">addChild</span>(model)<span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 变换</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    model<span class="op">.</span><span class="at">x</span> <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    model<span class="op">.</span><span class="at">y</span> <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    model<span class="op">.</span><span class="at">rotation</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    model<span class="op">.</span><span class="at">skew</span><span class="op">.</span><span class="at">x</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    model<span class="op">.</span><span class="at">scale</span><span class="op">.</span><span class="fu">set</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    model<span class="op">.</span><span class="at">anchor</span><span class="op">.</span><span class="fu">set</span>(<span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 交互</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    model<span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;hit&#39;</span><span class="op">,</span> (hitAreas) <span class="kw">=&gt;</span> {</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (hitAreas<span class="op">.</span><span class="fu">includes</span>(<span class="st">&#39;body&#39;</span>)) {</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            model<span class="op">.</span><span class="fu">motion</span>(<span class="st">&#39;tap_body&#39;</span>)<span class="op">;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>})()<span class="op">;</span></span></code></pre></div>
<h2 id="包导入">包导入</h2>
<p>当按需导入 Pixi 的包时，需要手动注册相应的组件来启用可选功能</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Application } <span class="im">from</span> <span class="st">&#39;@pixi/app&#39;</span><span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Ticker } <span class="im">from</span> <span class="st">&#39;@pixi/ticker&#39;</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { InteractionManager } <span class="im">from</span> <span class="st">&#39;@pixi/interaction&#39;</span><span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Live2DModel } <span class="im">from</span> <span class="st">&#39;pixi-live2d-display&#39;</span><span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">// 为 Live2DModel 注册 Ticker</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>Live2DModel<span class="op">.</span><span class="fu">registerTicker</span>(Ticker)<span class="op">;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">// 为 Application 注册 Ticker</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>Application<span class="op">.</span><span class="fu">registerPlugin</span>(TickerPlugin)<span class="op">;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">// 注册 InteractionManager 以支持 Live2D 模型的自动交互</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>Renderer<span class="op">.</span><span class="fu">registerPlugin</span>(<span class="st">&#39;interaction&#39;</span><span class="op">,</span> InteractionManager)<span class="op">;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>(<span class="kw">async</span> <span class="kw">function</span> () {</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> app <span class="op">=</span> <span class="kw">new</span> <span class="fu">Application</span>({</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">view</span><span class="op">:</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;canvas&#39;</span>)<span class="op">,</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> model <span class="op">=</span> <span class="cf">await</span> Live2DModel<span class="op">.</span><span class="fu">from</span>(<span class="st">&#39;shizuku.model.json&#39;</span>)<span class="op">;</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    app<span class="op">.</span><span class="at">stage</span><span class="op">.</span><span class="fu">addChild</span>(model)<span class="op">;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>})()<span class="op">;</span></span></code></pre></div>
<hr />
<p>示例的 Live2D 模型 Shizuku (Cubism 2.1) 和 Haru (Cubism 4) 遵守
Live2D 的 <a
href="https://www.live2d.com/eula/live2d-free-material-license-agreement_en.html">Free
Material License</a></p>
